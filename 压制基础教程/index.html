<!DOCTYPE html>
<html lang="zh-cn">
    <head>
  <!-- 元数据 -->
  <meta charset="utf-8">
  
    <link rel="icon" href="/img/favicon.svg">
  
  
  <title>压制基础教程（FXXS出品） | FXXS</title>
  <link rel="canonical" href="http://fxxs.github.io/%E5%8E%8B%E5%88%B6%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/">
  <meta name="author" content="ted423" />
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="robots" content="index,follow" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <meta name="format-detection" content="telphone=no, email=no" />
  
    <meta name="keywords" content="" />
  
  <meta name="description" content="源、编码、透明度对比源：源是指高质量可以用于进行压制编码的视频，一般包括蓝光圆盘、高质量的Web（一般4K的SDR）等。压片时应采用 最优质的源 进行压制，提高压制质量。 随着很多老片的BD推出，很多蓝光源是从低分辨率拉到高分辨率，被称为 Upscaled，在压制时应注意复原为原版的分辨率，不要压制过高的分辨率。关于WEB源应谨慎使用，尤其1080p的web-dl一般都为低质量不可以进行二次压制源">
<meta property="og:type" content="article">
<meta property="og:title" content="压制基础教程（FXXS出品）">
<meta property="og:url" content="http://fxxs.github.io/%E5%8E%8B%E5%88%B6%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/index.html">
<meta property="og:site_name" content="FXXS">
<meta property="og:description" content="源、编码、透明度对比源：源是指高质量可以用于进行压制编码的视频，一般包括蓝光圆盘、高质量的Web（一般4K的SDR）等。压片时应采用 最优质的源 进行压制，提高压制质量。 随着很多老片的BD推出，很多蓝光源是从低分辨率拉到高分辨率，被称为 Upscaled，在压制时应注意复原为原版的分辨率，不要压制过高的分辨率。关于WEB源应谨慎使用，尤其1080p的web-dl一般都为低质量不可以进行二次压制源">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://fxxs.github.io/img/Simple.png">
<meta property="og:image" content="http://fxxs.github.io/img/BDInfo.png">
<meta property="og:image" content="http://fxxs.github.io/(/img/simplex264.png">
<meta property="og:image" content="http://fxxs.github.io/img/AHDVEG-pics/Figure5.png">
<meta property="og:image" content="http://fxxs.github.io/img/AHDVEG-pics/Figure6.png">
<meta property="article:published_time" content="2025-10-08T13:37:48.042Z">
<meta property="article:modified_time" content="2025-10-11T06:48:01.998Z">
<meta property="article:author" content="ted423">
<meta property="article:tag" content="FXXS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://fxxs.github.io/img/Simple.png">
  
    <link rel="alternate" href="/atom.xml" title="FXXS" type="application/atom+xml">
  
  <!-- 样式表文件 -->
  <link rel="stylesheet" id="kratos-css" href="/css/kr-core.min.css" media="all"></link>
  
    <link rel="stylesheet" id="highlight-css" href="/css/highlight/highlight.js/night-eighties.min.css" media="all"></link>
  
  <link rel="stylesheet" id="theme-light-css" href="/css/kr-theme/light.min.css" media="all"></link>
  <link rel="stylesheet" id="theme-dark-css" href="/css/kr-theme/dark.min.css" media="(prefers-color-scheme: dark)"></link>
  <script src="/js/kr-theme.min.js"></script>
  <link rel="stylesheet" id="fontawe-css" href="/vendors/font-awesome@4.7.0/css/font-awesome.min.css" media="all"></link>
  
    <link rel="stylesheet" id="nprogress-css" href="/vendors/nprogress@0.2.0/nprogress.css" media="all"></link>
  
  
    <link rel="stylesheet" href="/vendors/viewerjs@1.11.6/dist/viewer.min.css"></link>
  
  <!-- 不得不预先加载的一些JS文件 -->
  
    <script src="/vendors/qr-code-styling@1.6.0-rc.1/lib/qr-code-styling.js"></script>
  
  <!-- 自定义站点横幅和背景 -->
  <style>
    
      .kratos-cover.kratos-cover-2 {
        background-image: url('');
      }
      html[data-theme="dark"] .kratos-cover.kratos-cover-2 {
        background-image: url('');
      }
    
    
      @media(min-width:768px) {
        body.custom-background {
          background-image: url('');
        }
        html[data-theme="dark"] body.custom-background {
          background-image: url('');
        }
      }
    
    
      .widget-kratos-about .photo-background {
        background-image: url('/images/default.webp');
      }
      html[data-theme="dark"] .widget-kratos-about .photo-background {
        background-image: url('/images/default.webp');
      }
    
  </style>

  <!-- 额外的追加注入项 -->
  
    <style>#kratos-widget-area #krw-toc .toc-item>.toc-child{max-height:unset}@media (min-width: 1200px) {.container {width:75%}}@media (min-width: 992px) {.col-md-8 {width: 75%;}.col-md-4 {width: 25%;}}</style>

  
<meta name="generator" content="Hexo 8.0.0"></head>

    <body class="custom-background">
        <div id="kratos-wrapper">
    <div id="kratos-page">
        <div id="kratos-header">
            <header id="kratos-desktop-topnav" class="kratos-topnav">
                <div class="container">
                    <div class="nav-header">
                        <nav id="kratos-menu-wrap">
                            <ul id="kratos-primary-menu" class="sf-menu">
                                
                            </ul>
                        </nav>
                    </div>
                </div>
            </header>
            <header id="kratos-mobile-topnav" class="kratos-topnav">
                <div class="container">
                    <div class="color-logo"><a href="/">FXXS</a></div>
                    <div id="kratos-nav-toggle-wrapper" class="nav-toggle">
                        <a id="kratos-nav-toggle" class="kratos-nav-toggle">
                            <i></i>
                        </a>
                    </div>
                </div>
            </header>
        </div>
        <div class="kratos-start kratos-hero-2">
            <!-- <div class="kratos-overlay"></div> -->
            <div class="kratos-cover kratos-cover-2 text-center">
                <div class="desc desc2 animate-box">
                    <a href="/">
                        <h2>FXXS</h2> <br />
                        <span>FXXS</span>
                    </a>
                </div>
            </div>
        </div>

        <div id="kratos-blog-post">
            <div class="container">
                <div id="main" class="row">


        

            

            <section class="kr-main-col col-md-8">

        

            <article itemscope itemtype="https://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://fxxs.github.io/%E5%8E%8B%E5%88%B6%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/">
    <div class="kratos-hentry kratos-page-inner clearfix">
        <header class="kratos-page-header">
            
                <h1 class="kratos-page-title text-center" itemprop="name headline">压制基础教程（FXXS出品）</h1>
            
            <ul class="kratos-page-meta text-center">
                <li><time datetime="2025-10-08T13:37:48.042Z" itemprop="datePublished"><i class="fa fa-calendar"></i> 2025-10-08</time></li>
                <li itemprop="author" itemscope itemtype="https://schema.org/Person">
                    <i class="fa fa-user"></i> 作者 <span itemprop="name">ted423</span>
                </li>
                
                    <li>
                        <i class="fa fa-edit"></i> 
                        
                        
                            ~22.71K
                        
                        字
                    </li>
                
                
                
            </ul>
        </header>
        <div class="kratos-page-content kr-post">
            
            
            
                <div class="kratos-post-inner-toc toc-div-class" >
                    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%BA%90%E3%80%81%E7%BC%96%E7%A0%81%E3%80%81%E9%80%8F%E6%98%8E%E5%BA%A6%E5%AF%B9%E6%AF%94"><span class="toc-number">1.</span> <span class="toc-text">源、编码、透明度对比</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#x264-%E4%B8%8E-x265"><span class="toc-number">2.</span> <span class="toc-text">x264 与 x265</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8E%8B%E5%88%B6%E7%8E%AF%E5%A2%83%E6%9E%84%E5%BB%BA"><span class="toc-number">3.</span> <span class="toc-text">压制环境构建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E7%A0%81%E5%99%A8"><span class="toc-number">3.1.</span> <span class="toc-text">编码器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VapourSynth"><span class="toc-number">3.2.</span> <span class="toc-text">VapourSynth</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%85%B6%E4%BB%96%E8%BD%AF%E4%BB%B6"><span class="toc-number">3.3.</span> <span class="toc-text">常用其他软件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8E%8B%E5%88%B6%E6%AD%A5%E9%AA%A4"><span class="toc-number">4.</span> <span class="toc-text">压制步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%8B%E5%88%B6%E6%BA%90%E5%88%86%E6%9E%90"><span class="toc-number">4.1.</span> <span class="toc-text">压制源分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E7%A6%BB%E6%8F%90%E5%8F%96-Demux-%E4%B8%8E%E9%9F%B3%E9%A2%91%E8%BD%AC%E6%8D%A2"><span class="toc-number">4.2.</span> <span class="toc-text">分离提取(Demux)与音频转换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BE%93%E5%85%A5%E8%84%9A%E6%9C%AC%E7%BC%96%E5%86%99"><span class="toc-number">4.3.</span> <span class="toc-text">输入脚本编写</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%87%E6%BA%90%E8%BD%BD%E5%85%A5-Index-a-video"><span class="toc-number">4.3.0.1.</span> <span class="toc-text">片源载入(Index a video)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%87%E9%99%A4%E8%BE%B9%E7%BC%98"><span class="toc-number">4.3.0.2.</span> <span class="toc-text">切除边缘</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%98%E6%8D%A2%E5%A4%A7%E5%B0%8F"><span class="toc-number">4.3.0.3.</span> <span class="toc-text">变换大小</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%BD%E5%8F%96%E6%B5%8B%E8%AF%95"><span class="toc-number">4.3.0.4.</span> <span class="toc-text">抽取测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%8B%E5%88%B6%E6%B5%8B%E8%AF%95"><span class="toc-number">4.3.1.</span> <span class="toc-text">压制测试</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%8B%E5%88%B6%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE"><span class="toc-number">4.3.1.1.</span> <span class="toc-text">压制参数配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CRF%E6%B5%8B%E8%AF%95"><span class="toc-number">4.3.1.2.</span> <span class="toc-text">CRF测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%88%E7%90%86%E7%A0%81%E7%8E%87%E8%AF%84%E5%88%A4%E6%96%B9%E5%BC%8F"><span class="toc-number">4.3.1.2.1.</span> <span class="toc-text">合理码率评判方式</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%BD%E6%B1%82%E4%BD%93%E7%A7%AF"><span class="toc-number">4.3.1.2.1.1.</span> <span class="toc-text">追求体积</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BF%9D%E8%AF%81%E4%B8%8E%E5%8E%9F%E7%9B%98%E7%9B%B8%E4%BC%BC%E9%80%8F%E6%98%8E%E5%BA%A6"><span class="toc-number">4.3.1.2.1.2.</span> <span class="toc-text">保证与原盘相似透明度</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%8F%82%E6%95%B0"><span class="toc-number">4.3.1.3.</span> <span class="toc-text">其他参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%80%E7%BB%88CRF%E6%B5%8B%E8%AF%95"><span class="toc-number">4.3.1.4.</span> <span class="toc-text">最终CRF测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%8B%E5%88%B6%E5%AF%B9%E6%AF%94%E8%84%9A%E6%9C%AC%E7%BC%96%E5%86%99"><span class="toc-number">4.3.1.5.</span> <span class="toc-text">压制对比脚本编写</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A3%E5%BC%8F%E5%8E%8B%E5%88%B6"><span class="toc-number">4.3.2.</span> <span class="toc-text">正式压制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85"><span class="toc-number">4.3.3.</span> <span class="toc-text">封装</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#VapourSynth-%E8%84%9A%E6%9C%AC-vpy-Filtering-%E5%9F%BA%E7%A1%80%E6%BB%A4%E9%95%9C%E4%BB%A5%E5%8F%8A%E5%A4%84%E7%90%86"><span class="toc-number">5.</span> <span class="toc-text">VapourSynth 脚本(vpy) Filtering 基础滤镜以及处理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%A9%E6%94%BE-Resizing"><span class="toc-number">5.1.</span> <span class="toc-text">缩放(Resizing)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8D%E8%84%8F%E7%BA%BF-Dirty-Lines-%E5%8F%8A%E4%B8%8D%E5%90%88%E9%80%82%E7%9A%84%E8%BE%B9%E7%BC%98-Borders"><span class="toc-number">5.2.</span> <span class="toc-text">修复脏线(Dirty Lines)及不合适的边缘(Borders)</span></a></li></ol></li></ol>
                </div>
            
            <hr />
            <div itemprop="articleBody"><h1 id="源、编码、透明度对比"><a href="#源、编码、透明度对比" class="headerlink" title="源、编码、透明度对比"></a>源、编码、透明度对比</h1><p><strong>源</strong>：源是指高质量可以用于进行压制编码的视频，一般包括蓝光圆盘、高质量的Web（一般4K的SDR）等。压片时应采用 <strong>最优质的源</strong> 进行压制，提高压制质量。</p>
<p>随着很多老片的BD推出，很多蓝光源是从低分辨率拉到高分辨率，被称为 Upscaled，在压制时应注意复原为原版的分辨率，不要压制过高的分辨率。关于WEB源应谨慎使用，尤其1080p的web-dl一般都为低质量不可以进行二次压制源，如非必要请勿压制，4k的SDR web源目前评价较好，往往好于1080p的BD来源，对于压制1080p的视频可以进行比较使用。</p>
<p><strong>！！！对于已经编码过的视频禁止二次编码！！！</strong> (通常而言，二次编码违反选择最优质源进行压制的原则。)</p>
<p><strong>编码</strong>：编码是指对于高质量来源进行压缩编码，进一步节约体积。编码过程种主要进行片源处理，修复源较为明显常见问题，通常包括脏边、色带、碎块、颜色偏差、伽马矫正等；切除黑边，去除源中16：9比例下的黑色边框；压制空间，主要将源采用更高的压缩方式进行重新编码，通常为有损方式。</p>
<p><strong>透明度(Transparency)</strong>：透明度是评价源于编码之间的相似程度的指标。良好的透明度是指在有经验的编码人员下都不能较为明显区分压制作品与源之间的差距。(此条不适用于 Anime 环境，二次元压制组看法不尽相同)</p>
<p>这个概念在外站(指PT)会比较流行</p>
<p>“透明度”指的是编码输出与源视频的匹配程度。一个更“透明”的编码成品会看起来更接近原始视频，而透明度较低的成品则会有明显的压缩瑕疵（compression artifacts）和&#x2F;或失真。<br>实现完美的透明度几乎是不可能的（尤其是在考虑到诸如抖动（dithering）之类的随机变量后）。编码的最终目标之一就是获得“透明”的编码成品，也就是尽可能地接近源视频。</p>
<p>一个“透明度”较高的视频通常意味着码率很高，通常高于源视频码率的50%。比较直观的说明是，当我觉高码给9000kbps(x265)的时候，外站压制给的20Mbps(x264)。</p>
<p>而对于我们组，我们并没有硬性要求，你可以基于透明度压制，也可以适当的控制码率。</p>
<p>根据I、P、B帧的功能，在编码过程中，编码器一般会尊重I帧内容，哪怕再劣质的压制，都不会对其进行明显的转换；而针对p帧，编码器可以转化为B帧进行编码节约空间，对于B帧进行重新编码。因此透明度应该从源与压制中P-&gt;B以及B-&gt;B的转换质量对比评判的压制质量。</p>
<p><strong>码率</strong>：码率是视频质量的基石，在编码一样，参数不乱给的情况下，不存在任何魔法能做到低码吊打高码。大部分视频压制参数或压制脚本的调整主要是为了码率分配以及视觉上的优化。如果你的目标是学习魔法的话，再次提醒，不存在这种东西，也注意不要在这块浪费精力。如果你想学习压制，你需要做的是根据视频画面给到足够的码率。再再次提醒，如果你之前没接触过相关信息，那么请忘掉你现有的对压制的任何观点，因为大部分都是错的。</p>
<p><strong>Bloating</strong>：称为臃肿，是指实现在相同透明度情况下，码率较高。根据压制较为广泛接受的规则，当压制作品太过接近源的码率也被认为 Bloating，数值如下表：(x265建议更小的比例)</p>
<table>
<thead>
<tr>
<th align="center"></th>
<th>1080p</th>
<th>720p</th>
<th>576p</th>
<th>480p</th>
</tr>
</thead>
<tbody><tr>
<td align="center">原盘码率比例</td>
<td>75%</td>
<td>50%</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h1 id="x264-与-x265"><a href="#x264-与-x265" class="headerlink" title="x264 与 x265"></a>x264 与 x265</h1><p>在获取比 VapourSynth 更容易找到的 x264 和 x265 编码器前，你也可以选择使用它们的修改版。 最主流 x264 的修改版是 tmod 。值得注意的改进包括 <strong>淡化补偿(fade-compensate)</strong> ，在 <strong>宏块树(mbtree)</strong> 开启的情况下对淡入淡出进行编码，以及更多的 <strong>自适应量化(aq-mode)</strong> 选项。而如果你希望在转码时更加精确地控制，毫无疑问你应该尝试使用 tmod 并捆绑使用它提供的<code>aq-mode</code>，这样你就能够从中榨取出更高的质量，从而在保护噪点的同时不至于破坏线条。</p>
<p>x265的优势在于它能够存储HDR信息，而且效率高得多，特别是类似低码率动漫这样的简单内容。</p>
<p>最主流的 x265 修改版则是 yukki ，相比 x264 的修改版它却没有那么让人印象深刻。所有这一切都包括一些外观上的变化，比如更准确的预计完成时间。</p>
<p><strong>8-bit 与 10-bit</strong></p>
<p>x264 8-bit，x265 10-bit。对于x264，8-bit有更多的硬件兼容性（10-bit几乎没有），而且速度明显更快。然而，10-bit x264通常能够节省相当多的空间，同时仍然比x265快。此外，10-bit编码在保留梯度方面要好得多（也就是说，你不必担心色带再次出现），这使得它在编码无噪点内容（比如动漫）方面非常受欢迎。</p>
<p><strong>参数</strong><br>x264参数(1080p)<br>注意事项，level 4.1 不支持 1080p@60fps，，4.2 ptp 会提示 DXVA:	Incompatible，这主要涉及一个早期设备的硬解兼容性问题，比较直观的解释就是 6年前的 firefly-rk3288 的开发板都支持 2160p@60fps 的 H264 硬解。</p>
<p>而 x265 吃了后出的红利，基本不用担心这块，不过也有逗逼不懂喜欢瞎设 level-idc,遇到这种的你知道他是菜逼就行了。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--crf * --preset placebo --profile high --level 4.1 --no-fast-pskip --threads auto --deblock -3,-3 --me umh --subme 11 --vbv-bufsize 78125 --vbv-maxrate 62500 --colormatrix bt709 --colorprim bt709 --merange 48 --rc-lookahead 60 --aq-mode 2 --no-mbtree  --no-dct-decimate --min-keyint 24  --ipratio 1.3 --pbratio 1.2 --aq-strength 0.8 --qcomp 0.65 --psy-rd 1.05:0.00 --bframes 16</span><br></pre></td></tr></table></figure>
<p>(crf可以用18)<br>ref说明</p>
<ul>
<li>480p ref&#x3D;16</li>
<li>576p ref&#x3D;14</li>
<li>720p ref&#x3D;9(-12)</li>
<li>1080p ref&#x3D;5</li>
</ul>
<p>ref开太高的话，ptp会提示 DXVA: Incompatible</p>
<p>请注意ref的计算，分辨率切黑边会导致 ref 可设置值下降，留空会自动计算</p>
<p>ref计算方法(机翻)：</p>
<blockquote>
<p>对于 --level 4.1，根据 H.264 标准，最大 DPB（解码图片缓冲区）大小为 12,288 千字节。由于每个帧都以 YV12 格式存储，即每像素 1.5 字节，因此 1920x1088 帧为<br>1920 × 1088 × 1.5 &#x3D; 3133440 字节 &#x3D; 3060 千字节。<br>12,288 ÷ 3060 千字节 &#x3D; 4.01568627，因此您最多可以使用 4 个参考帧。<br>请记住，在进行计算时，将两个维度向上舍入为 mod16 值，即使您没有对 mod16 进行编码！让我们对 1920x800 进行计算。<br>1920 × 800 × 1.5 &#x3D; 2304000 字节 &#x3D; 2250 千字节。12,288 ÷ 2250 千字节 &#x3D; 5.45777778，因此最多可 以使用 5 个参考帧。请注意，这些转换使用基数 2，<br>1 千字节 &#x3D;&#x3D; 1024 字节。如果计算错误，也没关系 - 如果使用太多，x264 将显示警告，你会知道是否需要更改它。</p>
</blockquote>
<p>x265 1080p 非HDR参数(仅供参考)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-D 10 --preset veryslower --level-idc 5.1 --ctu 32 --rd 4 --subme 5 --ref 5 --pmode --no-rect --no-amp --rskip 0 --tu-intra-depth 4 --tu-inter-depth 4 --range limited --no-open-gop --no-sao --rc-lookahead 100 --no-cutree --bframes 8 --vbv-bufsize 160000 --vbv-maxrate 160000 --colorprim bt709 --transfer bt709 --colormatrix bt709 --deblock -3:-3  --no-strong-intra-smoothing --ipratio 1.3 --pbratio 1.2 --qcomp 0.65 --aq-mode 2 --aq-strength 1.0 --psy-rd 1.00 --psy-rdoq 1.00</span><br></pre></td></tr></table></figure>

<p>x265的HDR参数(仅供参考,HDR参数需要计算，不能直接使用)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-D 10 --crf * --preset slower --level-idc 5.1 --bframes 8 --rd 4 --me 3 --subme 7 --ref 5 --merange 57 --ipratio 1.3 --pbratio 1.2 --aq-mode 2 --aq-strength 1.00 --qcomp 0.60 --psy-rd 1.5 --psy-rdoq 1.00 --ctu 64 --rc-lookahead 100 --deblock -3:-3 --no-strong-intra-smoothing --cbqpoffs 0 --crqpoffs 0 --qg-size 8 --range limited --no-frame-dup --selective-sao 0 --no-cutree --tu-intra-depth 4 --no-open-gop --tu-inter-depth 4 --rskip 0 --no-tskip --no-early-skip --min-keyint=1 --no-rect --no-amp --vbv-bufsize 160000 --vbv-maxrate 160000 --no-sao --aud --repeat-headers --hrd --hdr-opt --colorprim bt2020 --colormatrix bt2020nc --transfer smpte2084 --chromaloc 2 --pmode --master-display &quot;G(13250,34500)B(7500,3000)R(34000,16000)WP(15635,16450)L(40000000,50)&quot; --max-cll=577,512</span><br></pre></td></tr></table></figure>

<p><strong>其中的HDR参数应根据源进行计算设置</strong></p>
<h1 id="压制环境构建"><a href="#压制环境构建" class="headerlink" title="压制环境构建"></a>压制环境构建</h1><p>全套软件打包(请联系相关人员获取)</p>
<p>便携版压制软件带集成环境</p>
<p><a target="_blank" rel="noopener" href="https://github.com/FXXS-Encoder/MediaTool">https://github.com/FXXS-Encoder/MediaTool</a> (私有，需要申请权限)</p>
<p>VS集成环境(其他人维护，脚本可能不太全，ffms2等版本存在已知issue)</p>
<p><a target="_blank" rel="noopener" href="https://github.com/theChaosCoder/vapoursynth-portable-FATPACK">https://github.com/theChaosCoder/vapoursynth-portable-FATPACK</a></p>
<p>vapoursynth-classic 老版本维护(组内成员请勿使用)<br><a target="_blank" rel="noopener" href="https://github.com/AmusementClub/vapoursynth-classic">https://github.com/AmusementClub/vapoursynth-classic</a></p>
<blockquote>
<p>通常建议及时更新工具版本。</p>
</blockquote>
<h2 id="编码器"><a href="#编码器" class="headerlink" title="编码器"></a>编码器</h2><p>使用压制工具大部分核心都是x264和x265(x265如无必要不在重复)。本人推荐压制软件功能越为简单越好，比如适合新手的<a target="_blank" rel="noopener" href="https://github.com/lordmulder/Simple-x264-Launcher">Simple x264&#x2F;x265 Launcher</a>或纯命令行（CLI）。Simple x264&#x2F;x265 Launcher下载安装即可使用，本教程将以此为基础进行讲解。工具需要简单的设置，推荐log文件保存等设置，根据个人习惯修改。</p>
<p><img src="/img/Simple.png" alt="image-20200210024626480"></p>
<h2 id="VapourSynth"><a href="#VapourSynth" class="headerlink" title="VapourSynth"></a>VapourSynth</h2><p><a target="_blank" rel="noopener" href="http://www.vapoursynth.com/doc/">官方文档</a></p>
<p>VapourSynth是基于python编写新一代的视频处理工具，解决了许多AVS遗留的问题，显著提高了运行速度。</p>
<p><strong><a target="_blank" rel="noopener" href="https://www.python.org/">Python</a></strong> : 安装VS之前必须装好Python环境，不同VS版本要求的Python版本不同，下载安装前请先看好所需要的Python版本。安装时候必须选择 <em>Add Python to PATH</em> !!</p>
<p><strong><a target="_blank" rel="noopener" href="http://www.vapoursynth.com/">VapourSynth</a></strong> : VapourSynth的主体安装程序，安装过程推荐安装所有推荐内容。除了安装位置外推荐使用默认设置。安装完后只包括主程序，以及官方的自带的插件，VS使用过程需要大量的插件以及脚本：主要分为 <strong>Script(.py)脚本</strong> 和 <strong>Plugins(.dll)插件</strong> 两个部分。安装插件脚本，需要将对应文件放入对应目录，目录在官方文档内有详细介绍。在Windows下官方提供了方便的下载管理。下文对于使用到部分将会介绍。</p>
<p>请注意脚本主要是 Python 环境，Python 版本兼容，通过 import 加载，而dll加载与VS本身，是需要考虑系统兼容，通过 core.XXX 加载，很多插件没有 Release Linux 版本，所以 Linux 环境可能会有部分插件需要自己想办法编译或者没法编译。</p>
<p><strong>口语环境里，很多人会把脚本也叫成插件，但自己注意区分，以免造成混淆</strong></p>
<p>VS 最新提供了制作便携版的脚本，但需要注意，升级会需要一些手动操作，如 python 的 vs 包无法卸载。如果是个人使用搭建，建议用安装包</p>
<p>VapourSynth 文档中列出了放置插件的路径。</p>
<p>Windows 的推荐路径<code>&lt;AppData&gt;\VapourSynth\plugins32</code> 或 <code>&lt;AppData&gt;\VapourSynth\plugins64</code>。Unix 用户可以创建一个配置文件来指定路径。</p>
<p>VapourSynth的Python脚本应该放在你的Python site-packages文件夹中。在 Arch Linux上，位于 <code>/usr/lib64/Python3.*/sitepackages/</code>。Windows 用户可以在本地AppData文件夹【译者注：即<code>C:\Users\&lt;用户名&gt;\AppData\Local</code>】中找到这个文件夹。</p>
<p><strong>需要注意的是 Python 自身也会有个 site-packages 文件夹，注意不要放错位置或者混放，可能会造成不知道加载了什么东西的问题</strong></p>
<p><strong><a target="_blank" rel="noopener" href="https://github.com/theChaosCoder/VSRepoGUI/releases">VSRepoGUI</a></strong> ：官方提供了方便的下载管理插件以及脚本的GUI界面，下载解压后点开后即可使用，推荐放在VS的安装目录内。</p>
<p>通过软件可以查看对应的VS安装信息和脚本插件的所在位置，同时可以实现对插件的脚本安装、更新和卸载，软件插件安装位置，再右上角可以快速点开。在Windows下推荐本软件进行维护插件和脚本。</p>
<p>VSRepoGUi 操作的是 <a target="_blank" rel="noopener" href="https://github.com/vapoursynth/vsrepo">vsrepo.py</a>,这个脚本也可以手动使用，只是要在相应的路径里用，它会维护一个 json.一般来说，直接使用脚本可以看到报错。</p>
<p>VapourSynth 编辑器</p>
<ul>
<li>VapourSynth Editor <a target="_blank" rel="noopener" href="https://github.com/YomikoR/VapourSynth-Editor/releases/tag/r19-mod-5.1">推荐用YomikoR的mod版本</a></li>
<li>Yuuno</li>
<li>VapourSynth Preview</li>
<li>AvsPmod(长期不更新)</li>
</ul>
<p><strong>VapourSynth Editor</strong> ：VS Editor是目前较为广泛使用的VS编辑器(目前会使用Mod版本)。下载后，直接解压即可使用。第一次使用时候，需要配置VapourSynth文件的位置。VS plugins paths 可以是用VSRepoGUI中的路径进行查看。</p>
<p><strong>Yuuno</strong> 是 Jupyter 记事本的一个扩展，允许你编辑和导出 VapourSynth 脚本。你可以通过以下代码来安装。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">pip install yuuno</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">yuuno jupyter install</span></span><br></pre></td></tr></table></figure>

<p>注意你需要安装 Jupyter 或 Jupyter Lab。</p>
<p><strong>VapourSynth Preview</strong> 需要一个单独的文本编辑器或 IDE 来编写脚本，这使得它对那些不喜欢 VSEdit 中内置编辑器的人来说非常有用。<br>AvsPmod是用于 AviSynth 的编辑器，但它也支持 VapourSynth。 </p>
<p>它们都有各自的优点和缺点，但对于新手来说，我更推荐 VSEdit 进行本地编辑，而希望在服务器上也能够写脚本的用户，更推荐 Yuuno。这是因为 Jupyter 只需要少量配置就可以远程使用。建议 Yuuno 用户试试使用 Jupyter Lab 替代 Jupyter。</p>
<p>此处举例两者最大的差别：</p>
<p>VSEdit</p>
<ul>
<li>不需要保持浏览器开启</li>
<li>内置基准和编码工具</li>
<li>通过CTRL + SHIFT + 方向键轻松浏览视频</li>
<li>更稳定</li>
<li>几乎无需二次开发</li>
<li>大多数PT用户在使用它，因此它可能更容易获得帮助与支持</li>
<li>VapourSynth 特有的语法高亮及输入建议</li>
<li>允许你存储片段和模板</li>
</ul>
<p>Yuuno</p>
<ul>
<li>非常易于远程使用</li>
<li>可以通过 iPython magic 轻松导出</li>
<li>更好的比较工具，通过使用<code>%%vspreview clipa --diff clipb</code> ⇒ 实现鼠标悬停即可预览更改效果</li>
<li>程序不太成熟，因此更可能发生崩溃</li>
<li>允许你在一个 Jupyter 编辑器中处理和导出多个脚本</li>
</ul>
<h2 id="常用其他软件"><a href="#常用其他软件" class="headerlink" title="常用其他软件"></a>常用其他软件</h2><ul>
<li><strong><a target="_blank" rel="noopener" href="https://mediaarea.net/en/MediaInfo/Download/Windows">Mediainfo</a></strong> :媒体信息检查软件，查看片源以及压制信息使用。</li>
<li><strong><a target="_blank" rel="noopener" href="https://www.fosshub.com/MKVToolNix.html">MKVToolNix</a></strong>: mkv混流软件，也能实现以下基本的视频分割。</li>
<li><strong><a target="_blank" rel="noopener" href="https://github.com/SubtitleEdit/subtitleedit/releases">SubtitleEdit</a></strong>: 字幕编辑软，可以实现ORC等功能。</li>
<li><strong><a target="_blank" rel="noopener" href="http://rationalqm.us/dgdemux/dgdemux.html">DGDemux</a></strong>: Demux 软件，目前作为默认标准的Demux软件</li>
<li><strong><a target="_blank" rel="noopener" href="https://www.videohelp.com/software/eac3to">eac3to</a></strong>: <strong><a target="_blank" rel="noopener" href="https://github.com/ted423/FXXS-Encode-Guide/issues/14">存在已知Issue</a><strong>音轨转码编辑软件，也可实现Demux等功能。推荐使用</strong>eac3to with UsEac3to</strong>版本，并应包含一些对应的其他转换格式插件。</li>
<li><strong><a target="_blank" rel="noopener" href="https://www.videohelp.com/software/BDInfo">BDinfo</a></strong>: 蓝光原盘信息检测分析软件。</li>
<li><strong><a target="_blank" rel="noopener" href="https://www.videolan.org/index.zh.html">VLC</a></strong>: 能播放蓝光菜单，辅助确认音轨字幕章节信息</li>
</ul>
<p>其他请参考 <a href="/2.Tools/Collection">软件列表</a></p>
<p>基础部分软件直接使用或者安装即可。<br>AVS和VS为两种方向，推荐选VS</p>
<p>AVS相关教程Archive</p>
<h1 id="压制步骤"><a href="#压制步骤" class="headerlink" title="压制步骤"></a>压制步骤</h1><h2 id="压制源分析"><a href="#压制源分析" class="headerlink" title="压制源分析"></a>压制源分析</h2><p>要想做一个较为高质量作品，应采用最好的来源进行压制。HDR电影来源较为单一，4k的原盘和Remux资源为主，版本较少能选择不多。SDR目前可用压制版本较多，各个发行商的在不同时期也发行过不同蓝光版本，随着web的兴起，AZ和NF也都发布了较高码率的4k的sdr版本，所以在SDR压制时，需要对于来源进行对比，选取最为高质量的来源进行压制。对于蓝光原盘与remux两者相同时候，推荐使用Remux的更为方便。</p>
<p>对于原盘使用 <strong>BDInfo</strong> 检查原盘信息，查看原盘主要视频对应播放列表。对于复杂原盘，可能出现多版本混合的情况，需要确定所需要版本对应的MPLS，并确定原盘的主要码率 。在压制前推荐进行分离提取(Demux)后再进行压制。</p>
<p><img src="/img/BDInfo.png" alt="image"></p>
<h2 id="分离提取-Demux-与音频转换"><a href="#分离提取-Demux-与音频转换" class="headerlink" title="分离提取(Demux)与音频转换"></a>分离提取(Demux)与音频转换</h2><p>见<a target="_blank" rel="noopener" href="https://github.com/ted423/FXXS-Encode-Guide/blob/main/2.%20Tools/1.%20Demux%26Remux.md">Demux&amp;Remux</a>以及<a target="_blank" rel="noopener" href="https://github.com/ted423/FXXS-Encode-Guide/tree/main/3.%20Audio">Audio</a></p>
<h2 id="输入脚本编写"><a href="#输入脚本编写" class="headerlink" title="输入脚本编写"></a>输入脚本编写</h2><p>压制前一般需要对片源就行处理，一般包括去除黑边、修复脏边脏线、去除片源的一些问题等，并且在压制时一般需要进行部分压制测试，也需使用脚本进行实现。本节将对介绍压制中的最基本脚本的编写，分为VS和AVS两个部分。编写脚本使用对应的编辑器较为方便。以及基础例子如下</p>
<p><strong>avs例子</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FFVideoSource(<span class="string">&quot;J:\BluryBD\After.the.Storm.2016.BluRay.Remux.1080p.AVC.TrueHD.5.1-HiFi.mkv&quot;</span>)</span><br><span class="line">Crop(<span class="number">0</span>, <span class="number">20</span>, -<span class="number">0</span>, -<span class="number">22</span>)</span><br><span class="line">FillBorder(<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">bbmod(<span class="number">2</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">128</span>,<span class="number">21</span>)</span><br><span class="line">Z_Spline36Resize(<span class="number">1280</span>, <span class="number">692</span>,dither=<span class="string">&quot;error_diffusion&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>VS例子</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> vapoursynth <span class="keyword">as</span> vs</span><br><span class="line"><span class="comment">#import kagefunc as kgf</span></span><br><span class="line"><span class="keyword">import</span> fvsfunc <span class="keyword">as</span> fvf</span><br><span class="line"><span class="keyword">import</span> havsfunc <span class="keyword">as</span> haf</span><br><span class="line"><span class="comment">#import vsTAAmbk as taa</span></span><br><span class="line"><span class="comment">#import mvsfunc as mvf</span></span><br><span class="line"><span class="comment">#import muvsfunc as muf</span></span><br><span class="line"><span class="comment">#import nnedi3_resample as nnrs</span></span><br><span class="line"><span class="comment">#import nnedi3_rpow2 as nnrp</span></span><br><span class="line"><span class="keyword">import</span> awsmfunc <span class="keyword">as</span> awf</span><br><span class="line"><span class="comment">#import vsscale</span></span><br><span class="line"><span class="keyword">import</span> vsutil</span><br><span class="line"><span class="comment">#导入相关函数(上面导入的很多范例脚本中没有使用，不过去交错那用到了haf),awsmfunc早期包没包含，故先注释掉</span></span><br><span class="line"><span class="comment">#core = vs.core 在R55 API4及之后版本使用，早期版本可以使用vs.get_core()</span></span><br><span class="line"><span class="comment">#core = vs.get_core()</span></span><br><span class="line">core = vs.core</span><br><span class="line"><span class="comment">#请依据自己内存调整(单位MB)，通常16GiB的内存，设到8000左右就好了，x265还会占用一定内存，复杂脚本内存占用较高，开高了别的进程会卡慢。如果有这现象，可以再调低一些。大内存的话可以调高或者取消限制</span></span><br><span class="line">core.max_cache_size = <span class="number">8384</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#加载片源输入即为16bit色深</span></span><br><span class="line">src = core.lsmas.LWLibavSource(source=<span class="string">r&quot;J:\BluryBD\After.the.Storm.2016.BluRay.Remux.1080p.AVC.TrueHD.5.1-HiFi.mkv&quot;</span>,<span class="built_in">format</span>=<span class="string">&quot;yuv420p16&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#另一种加载片源</span></span><br><span class="line"><span class="comment">#src = core.ffms2.Source(source=r&#x27;J:\BluryBD\After.the.Storm.2016.BluRay.Remux.1080p.AVC.TrueHD.5.1-HiFi.mkv&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#通常来说，有些比较特殊的片源可能在ffms2或lsmas下会有不正常的表现或者报错，故有时候需要更换使用，例如 VC-1 lsmas 下不正常</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#PsF (站内搜索) 部分插件会检测是否交错 &gt; UnsupportedFieldBasedError(&#x27;Only progressive video is supported!&#x27;, func)</span></span><br><span class="line"><span class="comment">#src = core.std.SetFieldBased(src, 0) </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#处理前调整为16bit色深，可以降低运算带来的损失，lsmas不需要这个步骤</span></span><br><span class="line"><span class="comment">#src = fvf.Depth(src, 16)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#切边</span></span><br><span class="line">src=core.std.Crop(src, left=<span class="number">0</span>, right=<span class="number">0</span>, top=<span class="number">20</span>, bottom=<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#脏边处理相关</span></span><br><span class="line"><span class="comment">#FillBorders基本是复制一条或几条线，作为填充，在任何情况下都不建议超过一条使用</span></span><br><span class="line"><span class="comment">#src = core.fb.FillBorders(src, 0, 1, 0, 0, mode=&quot;fillmargins&quot;)</span></span><br><span class="line"><span class="comment">#src = core.edgefixer.Continuity(src,left=4, right=4, top=0, bottom=0)</span></span><br><span class="line"><span class="comment">#src = awf.fb(src, top=1,bottom=1)</span></span><br><span class="line"><span class="comment">#如果边缘呈灰色，awf.fb 可以填充 luma&amp;chroma</span></span><br><span class="line"><span class="comment">#src = awf.bbmod(src,left=3, right=6, top=10, bottom=4, thresh=30, blur=20)</span></span><br><span class="line"><span class="comment">#对于边缘本身不是正常画面的，可以接一下bbmode，但请注意，严禁乱用，具体参数请看Pro mit 翻译的AHD压制指南(Others里)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#AutoDeblock(请在指导下使用)</span></span><br><span class="line"><span class="comment">#src = fvf.AutoDeblock(src)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#将分辨率（压制为720p）</span></span><br><span class="line"><span class="comment">#src=core.resize.Spline36(src, 1280, 692)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#另一种缩小算法,gamma是HDR才需要开启</span></span><br><span class="line"><span class="comment">#src = muf.SSIM_downsample(src, 1280, 692, use_fmtc=False,gamma=True)</span></span><br><span class="line"><span class="comment">#src =vsscale.scale.ssim_downsample(src, width=None, height=720)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#去交错(正常不需要使用)</span></span><br><span class="line"><span class="comment">#src  = haf.QTGMC(src, Preset=&quot;slow&quot;, TFF=True)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#setFPS</span></span><br><span class="line"><span class="comment">#部分情况下，软件会判断错误的FPS，例如mediainfo里同时包含 Frame rate 和 Original frame rate  </span></span><br><span class="line"><span class="comment">#src = core.std.AssumeFPS(src,fpsnum=60000, fpsden=1001)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#去锯齿</span></span><br><span class="line"><span class="comment">#src = taa.TAAmbk(src, aatype=-3, preaa=-1, strength=0, mtype=2, opencl=True)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#转为10bit再输出，x265一般压制为10bit,x264为8bit</span></span><br><span class="line"><span class="comment">#之前得降bit函数</span></span><br><span class="line"><span class="comment">#src = fvf.Depth(src, 10)</span></span><br><span class="line"></span><br><span class="line">src = vsutil.depth(src, <span class="number">10</span>, dither_type=<span class="string">&#x27;error_diffusion&#x27;</span>)</span><br><span class="line">src.set_output()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Tips：</p>
<p>修复脏边脏线以及去色带等属于进阶部分，将单独介绍</p>
</blockquote>
<p>VS由C++编写的核心库和允许创建视频脚本的Python模块组成,脚本部分作为Python模块实现，因此脚本完全使用Python语法</p>
<p>看这里以便于理解vpy写法以及含义</p>
<p>Python 文档<a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3.9/reference/index.html">https://docs.python.org/zh-cn/3.9/reference/index.html</a></p>
<p>VS文档<a target="_blank" rel="noopener" href="http://www.vapoursynth.com/doc/pythonreference.html">http://www.vapoursynth.com/doc/pythonreference.html</a></p>
<p>其中最前面的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import vapoursynth as vs</span><br><span class="line">import kagefunc as kgf</span><br><span class="line">import fvsfunc as fvf</span><br><span class="line">import havsfunc as haf</span><br><span class="line">import vsTAAmbk as taa</span><br><span class="line">import mvsfunc as mvf</span><br><span class="line">import muvsfunc as muf</span><br><span class="line">import nnedi3_resample as nnrs</span><br><span class="line">import nnedi3_rpow2 as nnrp</span><br><span class="line">#import awsmfunc as awf</span><br></pre></td></tr></table></figure>

<p>就是 python 的 <a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3.12/tutorial/modules.html">模块&#x2F;modules</a> 的 <a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3.12/reference/import.html">导入&#x2F;import</a></p>
<h4 id="片源载入-Index-a-video"><a href="#片源载入-Index-a-video" class="headerlink" title="片源载入(Index a video)"></a>片源载入(Index a video)</h4><p>载入片源需要使用对应的解码器</p>
<p>可用的索引器可供考虑</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/vapoursynth/bestsource">bestsource</a><br>最准确但最慢的索引器。</li>
<li>lsmas<br>速度快，基本可靠。</li>
<li>ffms2<br>最新版本与 lsmas 相当，甚至可能更快。</li>
</ul>
<blockquote>
<p>DGIndexNV 在技术上也是您可以使用的，但最新版本存在错误，并且仅限于 Nvidia GPU。</p>
</blockquote>
<p><strong>avs语法</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FFVideoSource(<span class="built_in">str</span> filePath) <span class="comment">#指定文件的路径</span></span><br></pre></td></tr></table></figure>

<p><strong>VS语法</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">src = core.ffms2.Source(<span class="built_in">str</span> source) <span class="comment">#指定文件的路径</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Tips:</p>
<p>1.右键可以直接选择插入文件完整路径。</p>
<p>2.首次执行载入预览会卡死，需要等待一定时间。</p>
</blockquote>
<h4 id="切除边缘"><a href="#切除边缘" class="headerlink" title="切除边缘"></a>切除边缘</h4><p><strong>avs语法</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Crop(clip, <span class="built_in">int</span> left=<span class="number">0</span>,<span class="built_in">int</span> top=<span class="number">0</span>,<span class="built_in">int</span> -right=<span class="number">0</span>,<span class="built_in">int</span> -bottom=<span class="number">0</span>) <span class="comment">#切割必须为偶数，right与bottom为负数</span></span><br></pre></td></tr></table></figure>

<p><strong>VS语法</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clip=core.std.Crop(clip, <span class="built_in">int</span> left=<span class="number">0</span>, <span class="built_in">int</span> right=<span class="number">0</span>, <span class="built_in">int</span> top=<span class="number">0</span>, <span class="built_in">int</span> bottom=<span class="number">0</span>) <span class="comment">#切割必须为偶数</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Tips:</p>
<p>1.Crop切割方式只能以偶数方式切割，奇数切割属于进阶内容</p>
<p>2.切割奇数边需要使用下节介绍的resize方法</p>
</blockquote>
<h4 id="变换大小"><a href="#变换大小" class="headerlink" title="变换大小"></a>变换大小</h4><p><strong>avs语法</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">z_Spline36Resize(<span class="built_in">int</span> Width, <span class="built_in">int</span> height, <span class="built_in">int</span> src_left=?, <span class="built_in">int</span> src_top, <span class="built_in">int</span> src_width, <span class="built_in">int</span> src_height, <span class="built_in">str</span> dither) <span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p><strong>VS语法</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clip = core.resize.Spline36(clip clip, <span class="built_in">int</span> Width, <span class="built_in">int</span> height) <span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h4 id="抽取测试"><a href="#抽取测试" class="headerlink" title="抽取测试"></a>抽取测试</h4><p>压制前使用脚本一般间断抽取共约5k~10K帧进行参数测试，需要在脚本进行抽取。</p>
<p><strong>avs语法</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SelectRangeEvery(<span class="built_in">int</span> every, <span class="built_in">int</span> length, <span class="built_in">int</span> offset) <span class="comment">#every为间隔，length为长度，offset为启示帧数</span></span><br></pre></td></tr></table></figure>

<p><strong>VS语法</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select=core.std.SelectEvery(clip[<span class="number">8000</span>:-<span class="number">8000</span>],cycle=<span class="number">4000</span>, offsets=<span class="built_in">range</span>(<span class="number">10</span>))</span><br><span class="line">clip= core.std.AssumeFPS(select, fpsnum=clip.fps.numerator, fpsden=clip.fps.denominator)</span><br></pre></td></tr></table></figure>

<h3 id="压制测试"><a href="#压制测试" class="headerlink" title="压制测试"></a>压制测试</h3><p>在压制前应该进行参数测试，以便获取较高的压制质量，一般需要确定合理<strong>码率大小(crf)<strong>以及对于</strong>码率分配参数(ap-mode、ap-s、qcomp)<strong>以及</strong>psy</strong>等重要参数进行测试。使用抽取测试代码，大约抽取6k帧进行参数测试，送入<strong>Simple-x264</strong>进行测试。</p>
<h4 id="压制参数配置"><a href="#压制参数配置" class="headerlink" title="压制参数配置"></a>压制参数配置</h4><p>使用Simple进行压制，其设置如下所示。<strong>在设置界面记得开始log自动保存！！！</strong></p>
<p><img src="/(/img/simplex264.png" alt="image-20200220003824403"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--level <span class="number">4.1</span> --threads <span class="keyword">auto</span> --vbv-bufsize <span class="number">78125</span> --vbv-maxrate <span class="number">62500</span> --colormatrix bt709 --colorprim bt709 --no-mbtree --no-dct-decimate --min-keyint <span class="number">24</span> --me umh --merange <span class="number">48</span> --deblock=<span class="number">-3</span>,<span class="number">-3</span> --ipratio <span class="number">1.3</span> --pbratio <span class="number">1.2</span> --qcomp <span class="number">0.6</span> --aq-mode <span class="number">1</span> --aq-strength <span class="number">0.8</span> --psy-rd <span class="number">1.00</span>:<span class="number">0.00</span></span><br></pre></td></tr></table></figure>

<h4 id="CRF测试"><a href="#CRF测试" class="headerlink" title="CRF测试"></a>CRF测试</h4><p>CRF测试主要确定合适码率，根据压制目标，确定合理的码率。推荐测试起始CRF为17，根据范围码率以0.5步进进行CRF测试。</p>
<h5 id="合理码率评判方式"><a href="#合理码率评判方式" class="headerlink" title="合理码率评判方式"></a>合理码率评判方式</h5><h6 id="追求体积"><a href="#追求体积" class="headerlink" title="追求体积"></a>追求体积</h6><p>压制效果受码率影响很大，在追求体积时，很容易造成欠码的问题。所以要设置合理的码率范围，防止出现因为码率不足导致的质量问题。需要主要检查需要码率较高的场景，例如，复杂的场景和暗的场景。</p>
<p>主要辨别问题有：</p>
<ul>
<li>是否新产生了新的block</li>
<li>复杂的场景的细节是否丢失</li>
<li>是否压出明显的色带</li>
</ul>
<h6 id="保证与原盘相似透明度"><a href="#保证与原盘相似透明度" class="headerlink" title="保证与原盘相似透明度"></a>保证与原盘相似透明度</h6><p>前景无损失，背景没有明显损失</p>
<h4 id="其他参数"><a href="#其他参数" class="headerlink" title="其他参数"></a>其他参数</h4><blockquote>
<p>本部分十分建议进行，但是对于一些压制组不是强制要求。可以编写脚本进行批量测试</p>
</blockquote>
<p>确定合理的码率后，切换2-pass方式使用预计码率，采用单一变量方式进行参数测试，每次测试只改变一个参数，每个参数推荐测试范围如下：</p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">真人类型</th>
<th align="center">步进</th>
</tr>
</thead>
<tbody><tr>
<td align="center">qcomp</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody></table>
<h4 id="最终CRF测试"><a href="#最终CRF测试" class="headerlink" title="最终CRF测试"></a>最终CRF测试</h4><p>在新参数下，进行最终使用的crf测试。</p>
<h4 id="压制对比脚本编写"><a href="#压制对比脚本编写" class="headerlink" title="压制对比脚本编写"></a>压制对比脚本编写</h4><p>avs语法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入压制使用的脚本文件，并添加帧信息与名字</span></span><br><span class="line">a=<span class="keyword">import</span>(<span class="string">&quot;C:\Path\To\source.avs&quot;</span>).subtitle(<span class="string">&quot;Source&quot;</span>, align=<span class="number">9</span>).ffinfo(framenum=true,frametype=true,cfrtime=false,vfrtime=false,version=false,cropping=false,colorrange=false,colorspace=false,sar=false) </span><br><span class="line"><span class="comment"># 导入压制后的对比的视频文件</span></span><br><span class="line">b=ffvideosource(<span class="string">&quot;C:\Path\To\b.mkv&quot;</span>).subtitle(<span class="string">&quot;b&quot;</span>, align=<span class="number">9</span>).ffinfo(framenum=true,frametype=true,cfrtime=false,vfrtime=false,version=false,cropping=false,colorrange=false,colorspace=false,sar=false)</span><br><span class="line"><span class="comment"># 其他的压制文件</span></span><br><span class="line">c=ffvideosource(<span class="string">&quot;C:\Path\To\c.mkv&quot;</span>).subtitle(<span class="string">&quot;c&quot;</span>, align=<span class="number">9</span>).ffinfo(framenum=true,frametype=true,cfrtime=false,vfrtime=false,version=false,cropping=false,colorrange=false,colorspace=false,sar=false)</span><br><span class="line"><span class="comment"># 交错视频文件</span></span><br><span class="line">interleave(a,b)</span><br></pre></td></tr></table></figure>

<p><strong>VS语法</strong></p>
<p><strong>下面的代码大部分已经不能在最新的VS里使用，仅作参考，请使用 awf 以及 Scrips 里的 snap</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> vapoursynth <span class="keyword">as</span> vs</span><br><span class="line">core = vs.get_core()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成帧信息，并打入标签</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">FrameInfo</span>(<span class="params">clip, title,</span></span><br><span class="line"><span class="params">              style=<span class="string">&quot;sans-serif,20,&amp;H00FFFFFF,&amp;H000000FF,&amp;H00000000,&amp;H00000000,0,0,0,0,100,100,0,0,1,2,0,7,10,10,10,1&quot;</span></span>):</span><br><span class="line">    <span class="keyword">import</span> functools</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">FrameProps</span>(<span class="params">n, clip</span>):</span><br><span class="line">        clip = core.sub.Subtitle(clip, <span class="string">&quot;Frame &quot;</span> + <span class="built_in">str</span>(n) + <span class="string">&quot; of &quot;</span> + <span class="built_in">str</span>(</span><br><span class="line">            clip.num_frames) + <span class="string">&quot;\nPicture type: &quot;</span> + clip.get_frame(n).props._PictType.decode(), style=style)</span><br><span class="line">        <span class="keyword">return</span> clip</span><br><span class="line"></span><br><span class="line">    clip = core.std.FrameEval(clip, functools.partial(FrameProps, clip=clip))</span><br><span class="line">    clip = core.sub.Subtitle(clip, [<span class="string">&#x27;\n \n \n&#x27;</span> + title], style=style)</span><br><span class="line">    <span class="keyword">return</span> clip</span><br><span class="line"></span><br><span class="line"><span class="comment"># VS editor输出显示bug，对于压制后的文件需要进行，进行处理。</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">outfix</span>(<span class="params">clip</span>):</span><br><span class="line">	encode = core.std.SetFrameProp(clip,prop=<span class="string">&quot;_Matrix&quot;</span>,delete=<span class="literal">True</span>)</span><br><span class="line">	encode = core.std.SetFrameProp(encode,prop=<span class="string">&quot;_Transfer&quot;</span>,delete=<span class="literal">True</span>)</span><br><span class="line">	encode = core.std.SetFrameProp(encode,prop=<span class="string">&quot;_Primaries&quot;</span>,delete=<span class="literal">True</span>)</span><br><span class="line">	<span class="keyword">return</span> encode</span><br><span class="line"></span><br><span class="line"><span class="comment">#-------------用于压制脚本的滤镜部分（例子）----------------#</span></span><br><span class="line"><span class="comment">#复制自己脚本出了导入，和输出部分内容</span></span><br><span class="line">video = core.ffms2.Source(source=<span class="string">r&#x27;/Users/hujingyu/Encode/Paris.Texas.1984.1080p.BluRay.Remux.AVC.DTS-HD.MA.5.1-PmP.mkv&#x27;</span>)</span><br><span class="line">video=core.std.Crop(video,<span class="number">64</span>,<span class="number">64</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">select=core.std.SelectEvery(video[<span class="number">8000</span>:-<span class="number">8000</span>],cycle=<span class="number">4000</span>, offsets=<span class="built_in">range</span>(<span class="number">80</span>))</span><br><span class="line">video= core.std.AssumeFPS(select, fpsnum=video.fps.numerator, fpsden=video.fps.denominator)</span><br><span class="line"><span class="comment">#-------------用于压制脚本的滤镜部分----------------#</span></span><br><span class="line">video=FrameInfo(video,<span class="string">&quot;source&quot;</span>)<span class="comment"># 标记信息</span></span><br><span class="line"><span class="comment">#-------------encode文件-------------------------#</span></span><br><span class="line">encode=core.ffms2.Source(source=<span class="string">r&quot;/whalehu/Encode/encode.mkv&quot;</span>) <span class="comment"># 载入视频</span></span><br><span class="line">encode=FrameInfo(encode,<span class="string">&quot;encode&quot;</span>) <span class="comment"># 标记信息</span></span><br><span class="line">encode=outfix(encode)<span class="comment"># 输入修复</span></span><br><span class="line"></span><br><span class="line">out = core.std.Interleave([video,encode]) <span class="comment"># 交叉帧</span></span><br><span class="line">out.set_output()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="正式压制"><a href="#正式压制" class="headerlink" title="正式压制"></a>正式压制</h3><p>将压制脚本中的测试抽帧代码注释掉，进行正式压制。</p>
<blockquote>
<p>清晰度越高需要的时间越长，推荐使用较低的分辨率入门</p>
</blockquote>
<h3 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h3><p>封装是将所有素材合成一个mkv的视频文件，封装是一个很简单的工作，没有技术难点，但是封装的好坏会对压制作品评价很为重要，封装主要是认真。这里主要介绍被广泛接受的封装细节，不同压制组对这个有具体的细节要求。</p>
<p>一般封装主要注意以及下内容：</p>
<ul>
<li><p>视频、音轨和字幕是否匹配</p>
</li>
<li><p>音轨和字幕是否设置了正确的语言标签</p>
</li>
<li><p>需要标准命名的音轨是否正确</p>
</li>
<li><p>章节信息和标题是否添加并正确命名</p>
</li>
<li><p>正确命名文件标题</p>
</li>
</ul>
<blockquote>
<p>文件标题并不是文件名！！！一般主要为IMDB的英文标题并可以添加小组信息</p>
</blockquote>
<h1 id="VapourSynth-脚本-vpy-Filtering-基础滤镜以及处理"><a href="#VapourSynth-脚本-vpy-Filtering-基础滤镜以及处理" class="headerlink" title="VapourSynth 脚本(vpy) Filtering 基础滤镜以及处理"></a>VapourSynth 脚本(vpy) Filtering 基础滤镜以及处理</h1><h2 id="缩放-Resizing"><a href="#缩放-Resizing" class="headerlink" title="缩放(Resizing)"></a>缩放(Resizing)</h2><p>首先请注意，后面会有一个单独的部分来介绍 <strong>还原分辨率(Descaling)</strong> 。而在这，我将解释调整大小的方法以及哪种调整器分别适合什么情况。<br>如果你想调整大小，重要的是不要超过必要的长宽比的改变。如果你要缩小尺寸，首先要搞明白宽度和高度应该是多少。如果你想缩小分辨率到720p，首先要裁剪，然后弄清楚你是缩放至720高还是1280宽。如果是前者，你的宽度应该是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">width = <span class="built_in">round</span>(<span class="number">720</span> * src.height / (<span class="number">2</span> * src.width)) * <span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>对于后者，你会发现高度的代码与其非常相似：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">height = <span class="built_in">round</span>(<span class="number">1280</span> * src.width / (<span class="number">2</span> * src.height)) * <span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>你也可以使用 awsmfunc 中封装的 <code>cropresize</code> 函数来处理这些计算并调整大小。</p>
<p>现在有多种调整工具可选，其中最主要的有：</p>
<ul>
<li><code>Point</code> 临近点，也被称为临近采样(nearest neighbor resizing)，是最简单的缩放方式，因为除了放大每个像素或缩小时获取周围每个像素的平均值，并没有真正做任何事情。它产生的结果很糟糕，但在放大时不做任何模糊处理，因此它非常适用于放大检查每个像素的值。它也是自我矛盾的，所以你可以用它放大然后再缩小，得到与开始时相同的结果。</li>
<li><code>Bilinear</code> 双线性，缩放处理速度非常快，但会导致非常模糊的结果，并有明显的 <strong>锯齿(aliasing)</strong> 现象。</li>
<li><code>Bicubic</code> 双立方，缩放处理速度同样很快，但也会导致相当模糊的结果和明显的锯齿。你可以在这里修改参数以获得更清晰的结果，但这将导致更多的锯齿。</li>
<li><code>Lanczos</code> 缩放速度较慢，但可以得到非常清晰的结果。然而，它会产生了非常明显的振铃(ringing) <a href="/1.%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E7%91%95%E7%96%B5%E8%AF%B4%E6%98%8E#%E4%BC%AA%E5%BD%B1-artifact">伪影</a>(artifact) 。</li>
<li><code>Blackmanminlobe</code> 一个 <code>lanczos</code> 的改良版（需要通过 <code>fmtconv</code> 来调用它缩放）具有较少的振铃伪影。这种调整工具对于YUV444编码的色度提升绝对值得考虑（稍后会详细介绍）。</li>
<li><code>Spline</code> 其缩放速度相当慢，但可以得到非常好的结果。有多种 <code>Spline</code> 调整工具可用，<code>Spline16</code> 比 <code>Spline36</code> 快，但效果稍差，而 <code>Spline36</code> 与 <code>Spline64</code> 效果十分相似，所以没有理由使用后者。推荐在缩小分辨率(downscaling)时使用 <code>Spline36</code>。</li>
<li><code>nnedi3</code> 其调整大小的速度相当慢，而且只能以2的幂数进行 <strong>放大像素(upscale)</strong> 。它也可以与 <code>Spline36</code> 结合起来，先将其分辨率放大，而后缩小所需的分辨率。结果明显好于前述的内核。</li>
<li><code>FSRCNNX</code> 是一个用于 mpv 的着色器，可以通过 <code>vs-placebo</code> 插件使用。它提供了远比 <code>nnedi3</code> 更清晰的结果，但需要GPU的支持。如果可以的话，建议使用它来进行放大分辨率。</li>
</ul>
<p>附录中提供了这些调整工具的效果比较，图16为降低分辨率，图17为放大像素。此外，由于更改 <code>bicubic</code> 的参数将输出非常显着区别的结果，因此在附录图18还包括了对不同参数配置的 <code>bicubic</code> 放大比例的比较示例。为了满足更强的好奇心，我在图19中加入了缩小至原始分辨率后的对比，并且在附录中的图20中展示了同一调整工具先缩小再放大的情况。 </p>
<p>虽然这些截图应该可以帮助你对不同缩放方法之间的差异有一个大致的了解，但它们只是单个画面的一小部分。如果你想更好地了解这些调整工具对整体画面的影响，我建议你自己动手使用，在动态中观察它们，并将它们交错在一起(<code>std.Interleave</code>)进行对比。 </p>
<p>降低分辨率时不同调整工具之间的差异比放大时要小得多。 但不建议以此为借口，在降低分辨率时因偷懒而随意选择调整工具。 </p>
<p>简而言之: 用 <code>core.resize.Spline36</code> 来缩小分辨率。</p>
<h2 id="修复脏线-Dirty-Lines-及不合适的边缘-Borders"><a href="#修复脏线-Dirty-Lines-及不合适的边缘-Borders" class="headerlink" title="修复脏线(Dirty Lines)及不合适的边缘(Borders)"></a>修复脏线(Dirty Lines)及不合适的边缘(Borders)</h2><p>另一个非常常见的问题，至少在真人电影的内容中，是脏线。这类问题通常出现在视频的边界上，与周围的行相比，某一行或某一列的像素通常表现出过低的亮度值。通常情况下，这是由于不适当地缩小分辨率，更明显的是在应用边框后的缩小分辨率。脏线也可能发生，因为视频编辑者往往不知道他们是在YUV422下工作的，这意味着他们的竖向像素值不必是偶数；而消费者内容将是YUV420，意味着竖向像素值必须是偶数，导致额外的黑行。</p>
<p>另一种形式的脏线是在黑条上出现色度平面时表现出来的。 通常情况下，这些应该被裁剪掉。然而，相反的情况也可能发生，即具有合法的亮度信息的平面但缺乏色度信息。 有六种常用的滤镜用于修复脏线。</p>
<ul>
<li><p><strong>cf</strong>的<code>ContinuityFixer</code></p>
<p><code>ContinuityFixer</code> 的工作原理是将指定的行&#x2F;列与周围范围指定的行&#x2F;列数量进行比较，通过最小二乘法再回归找到新值。其设置如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fix = core.cf.ContinuityFixer(src=clip, left=[<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], right=[<span class="number">0</span>, <span class="number">0</span>,<span class="number">0</span>], top=[<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], bottom=[<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], radius=<span class="number">1920</span>)</span><br></pre></td></tr></table></figure>

<p>这是假设你使用的是1080p的素材，因为半径的值被设置为源的分辨率所定义的最长的集合。我建议使用一个更低的值，但不要低于3，因为在这一点上，你可能是在复制像素（参见下面的<code>FillBorders</code>）。可能会让大多数新手感到困惑的是，我输入了一个数组，作为要固定的行&#x2F;列的值。这些值表示要应用到三个平面上的值。通常情况下，脏线只会发生在亮度平面上，所以你通常可以把其他两个平面的值保持为0。 请注意，数组并非必须，因此您也可以只输入希望应用修复的行&#x2F;列的数量，所有平面都会被处理。<br><code>ContinuityFixer</code> 最擅长的一点是去除不规则的东西，比如点。 它也比 <code>bbmod</code> 和 <code>FixBrightnessProtect2</code> 快，但它应该被视为这两者的备选方案。</p>
</li>
<li><p><strong>awsmfunc</strong>的<code>bbmod</code></p>
<p>这是原<code>BalanceBorders</code> 函数的一个修改版。它与 <code>ContinuityFixer</code> 非常相似，但在更高的 <strong>模糊值(blur)</strong> 和 <strong>阈值(thresh)</strong> 的情况下会产生更好的效果。如果它没有产生去分的结果，可以改变这些，但是你设置的模糊值越低，这个函数的破坏性就越大。它也比 <code>havsfunc</code> 和 <code>sgvsfunc</code> 中的版本快得多，因为只有必要的像素被处理。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> awsmfunc <span class="keyword">as</span> awf</span><br><span class="line">bb = awf.bbmod(src=clip, left=<span class="number">0</span>, right=<span class="number">0</span>, top=<span class="number">0</span>, bottom=<span class="number">0</span>,thresh=[<span class="number">128</span>, <span class="number">128</span>, <span class="number">128</span>], blur=[<span class="number">20</span>, <span class="number">20</span>, <span class="number">20</span>], scale_thresh=<span class="literal">False</span>,cpass2=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<p><code>thresh</code> 和 <code>blur</code> 的数组也是Y、U和V的值。建议先试试 <code>blur=999</code>，然后尝试降低这个和 <code>thresh</code> 的值，反复尝试，直到你得到合适的效果。<br><code>thresh</code>指定了结果可以和输入值相差多少。<code>blur</code> 是过滤器的强度，数值越低越强，数值越大则越弱。如果你设置 <code>blur=1</code> ，你基本上就等同于复制行。</p>
</li>
<li><p><strong>fb</strong>的<code>FillBorders</code></p>
<p>这个函数几乎就是复制下一列&#x2F;行的内容。虽然这听起来很傻，但当分辨率缩小导致更多的行在底部而不是顶部，并且由于YUV420的偶数的竖向像素值，我们不得不填充一行时，它就会非常有用。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fill = core.fb.FillBorders(src=clip, left=<span class="number">0</span>, right=<span class="number">0</span>, bottom=<span class="number">0</span>, top=<span class="number">0</span>, mode=<span class="string">&quot;fillmargins&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>这个函数的一个非常有趣的应用是类似于只对色度平面应用 <code>ContinuityFixer</code>，它可以用在灰色边界或无论应用什么亮度平面修复的修复方法都与边界不匹配他们的环境时。这可以用下面的脚本来完成：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fill = core.fb.FillBorders(src=clip, left=<span class="number">0</span>, right=<span class="number">0</span>, bottom=<span class="number">0</span>, top=<span class="number">0</span>, mode=<span class="string">&quot;fillmargins&quot;</span>)</span><br><span class="line">merge = core.std.Merge(clipa=clip, clipb=fill, weight=[<span class="number">0</span>,<span class="number">1</span>])</span><br></pre></td></tr></table></figure>

<p>你也可以分离平面并单独处理色度平面，尽管这只是稍微快一点。允许您为fb【译者注：<code>core.fb</code>】指定每个平面值的封装函数是 <strong>awsmfunc</strong> 中的 <code>FillBorders</code>。</p>
</li>
<li><p><strong>edgefixer</strong>的<code>ReferenceFixer</code></p>
<p>这需要原始版本的edgefixer（cf只是它的一个旧的移植版本，但它使用起来更漂亮，处理过程也没有改变）。我从来没有发现它有什么用处，但从理论上讲，它是很好的。它与一个参考素材进行比较，以调整其边缘固定。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fix = core.edgefixer.Reference(src, ref, left=[<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], right=[<span class="number">0</span>, <span class="number">0</span>,<span class="number">0</span>], top=[<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], bottom=[<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], radius = <span class="number">1920</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>rekt</strong>的 <code>rektlvls</code></p>
<p>这基本上是 <code>FixBrightnessProtect</code> 和 <code>FixBrightness</code> 的合二为一，另外还有一个事实，即不是整个画面都被处理。它的参数非常简单明了，提高调整值可以变亮，降低调整值可以变暗。将 <code>prot_val</code> 设置为0时，它的功能就与 <code>FixBrightness</code>相同，意味着调整值需要改变。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rekt <span class="keyword">import</span> rektlvls</span><br><span class="line">fix = rektlvls(src, rownum=<span class="literal">None</span>, rowval=<span class="literal">None</span>, colnum=<span class="literal">None</span>, colval=<span class="literal">None</span>, prot_val=<span class="number">20</span>)</span><br></pre></td></tr></table></figure>

<p>如果你想一次处理多行，你可以输入一个列表（例如，<code>rownum=[0, 1, 2]</code>）。</p>
</li>
</ul>
<p>有一点不应该被忽视的是，对太多的行&#x2F;列应用这些修正（除了 <code>rektlvls</code> 之外）可能会导致最终结果看起来很模糊。正因为如此，我们建议尽可能使用 <code>rektlvls</code>，或只在必要的行上使用亮度修复。如果失败了，最好在使用 <code>ContinuityFixer</code> 之前先试试 <code>bbmod</code>。</p>
<p>值得注意的是，你总是应该在调整大小之前修复脏线，否则做会引入更多的脏线。然而，更需注意的是，如果你在边缘使用 <code>FillBorders</code> 填充了一条黑线，你应该使用调整大小的工具来删除它。例如，要将一个顶部有一条填充线的片段从1920 × 1080调整为1280 × 536时应该这么做：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">top_crop = <span class="number">138</span></span><br><span class="line">bot_crop = <span class="number">138</span></span><br><span class="line">top_fill = <span class="number">1</span></span><br><span class="line">bot_fill = <span class="number">0</span></span><br><span class="line">src_height = src.height - (top_crop + bot_crop) - (top_fill + bot_fill)</span><br><span class="line">crop = core.std.Crop(src, top=top_crop, bottom=bot_crop)</span><br><span class="line">fix = core.fb.FillBorders(crop, top=top_fill, bottom=bot_fill, mode=<span class="string">&quot;fillmargins&quot;</span>)</span><br><span class="line">resize = core.resize.Spline36(<span class="number">1280</span>, <span class="number">536</span>, src_top=top_fill, src_height=src_height)</span><br></pre></td></tr></table></figure>

<p>如果你要处理对角线的边框，正确的做法是使用蒙版覆盖源，用<code>FillBorders</code> 调用合并源。为此举一个例子（来自D-Z0N3压制的作品《你的名字》）：</p>
<p><img src="/img/AHDVEG-pics/Figure5.png" alt="Figure5"></p>
<p>图5：该示例为《你的名字》（Your Name (2016)）中不恰当地使用边框。D-Z0N3的使用了蒙版，而Geek没有。 因此，Geek缺乏任何类似的纹理，而D-Z0N3则尽可能地保留它。使用 <code>FillBorders</code> 中的镜像模式可能更明智，但事后看来是20&#x2F;20【译者注： “20&#x2F;20视力”称为“完美”视力】。</p>
<p>D-Z0N3使用的代码（16-bit下）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mask = core.std.ShufflePlanes(src, <span class="number">0</span>, vs.GRAY).std.Binarize(<span class="number">43500</span>)</span><br><span class="line">cf = core.fb.FillBorders(src, top=<span class="number">6</span>).std.MaskedMerge(src, mask)</span><br></pre></td></tr></table></figure>

<p>在附录中的图22下有一个例子，说明为什么要使用蒙版。 </p>
<p>为了说明脏线可能是什么样子，这里有一个 <code>ContinuityFixer</code> 和纯色的 <code>FillBorders</code> 对比的例子。</p>
<p><img src="/img/AHDVEG-pics/Figure6.png" alt="Figure6"></p>
<p>图6：来源于的D-Z0N3的压制作品《无声的声音》（A Slinet Voice (2016)）的脏线修复与过滤。在最上面的三行使用 <code>ContinuityFixer</code>，在最左边的两列使用<code>FillBorders</code>。 当前画面放大15倍。</p>
<p>脏线很难发现。如果你在随机检查不同帧的边界时候不能发现存在脏线，那么可能就没有问题。如果你发现有每边都有小黑线边界，那么可以使用类似下面的脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">black_detect</span>(<span class="params">clip, thresh=<span class="literal">None</span></span>):</span><br><span class="line">	<span class="keyword">if</span> thresh == <span class="literal">None</span>:</span><br><span class="line">		thresh = (<span class="number">25</span> * (<span class="number">1</span> &lt;&lt; clip.<span class="built_in">format</span>.bits_per_sample) - <span class="number">1</span>) / <span class="number">255</span></span><br><span class="line">	mask = core.std.ShufflePlanes(clip, <span class="number">0</span>, vs.GRAY).std.Binarize(&#123;<span class="number">0</span>&#125;<span class="string">&quot;.format(thresh)).std.Invert().std.Maximum().std.Inflate().std.Maximum().std.Inflate()</span></span><br><span class="line"><span class="string">	l = core.std.Crop(mask, right=clip.width / 2)</span></span><br><span class="line"><span class="string">	r = core.std.Crop(mask, left=clip.width / 2)</span></span><br><span class="line"><span class="string">	mask_test = core.std.StackHorizontal([r, l])</span></span><br><span class="line"><span class="string">	t = core.std.Crop(mask_test, top=clip.height / 2)</span></span><br><span class="line"><span class="string">	b = core.std.Crop(mask_test, bottom=clip.height / 2)</span></span><br><span class="line"><span class="string">	mask_test = core.std.StackVertical([t, b])</span></span><br><span class="line"><span class="string">return mask_test</span></span><br></pre></td></tr></table></figure>

<p>这个脚本将 <code>threshold</code> 以下的数值（即黑色边框）在大部分黑色背景的中部显示为垂直或水平白线。你可以运用这个函数来浏览并检查你的视频。你也可以尝试使用 <code>blckdtct27</code>，它可以为你扫描视频。 </p>
<p>其他类型的可变脏线是一个修复难题(a bitch to fix)，需要手动检查场景。</p>
<p> 一个与脏线非常相似的问题是糟糕的边界(bad borders)。在不同场景中（例如IMAX或4:3），黑色边框有时可能不完全是黑色的，或者完全被打乱了。为了解决这个问题，只需将其裁剪并重新添加。你也可能想修复过程中可能出现的脏线：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">crop = core.std.Crop(src, left=<span class="number">100</span>, right=<span class="number">100</span>)</span><br><span class="line">clean = core.cf.ContinuityFixer(crop, left=<span class="number">2</span>, right=<span class="number">2</span>, top=<span class="number">0</span>, bottom=<span class="number">0</span>, radius=<span class="number">25</span>)</span><br><span class="line">out = core.std.AddBorders(clean, left=<span class="number">100</span>, right=<span class="number">100</span>)</span><br></pre></td></tr></table></figure>
</div>
        </div>
        
        <footer class="kratos-entry-footer clearfix">
            
            
            
                <div class="post-actions text-center clearfix" id="post-actions">
                
                
                    <a class="share" href="javascript:;" onclick="krOpenShareModal()"><i class="fa fa-share-alt"></i> 分享</a>
                
                </div>
            
            <div class="footer-tag clearfix">
                <div class="pull-left">
                <i class="fa fa-tags"></i>
                    
                </div>
                <div class="pull-date">
                    <time datetime="2025-10-11T06:48:01.998Z" itemprop="dateModified">最后编辑：2025-10-11</time>
                </div>
            </div>
        </footer>
    </div>
    
        <nav class="navigation post-navigation clearfix" role="navigation">
            
            <div class="nav-previous clearfix">
                <a title=" FXXS压制教程 序 FXXS Encode Guide README" href="/README/"><i class="fa fa-angle-left"></i> 上一篇</a>
            </div>
            
            
            <div class="nav-next clearfix">
                <a title=" 2.0/1.0 音轨比较说明" href="/4.Audio&sub/2.01.0音轨说明/">下一篇 <i class="fa fa-angle-right"></i></a>
            </div>
            
        </nav>
    
    
        <div class="comment-post">
            <div id="disqus_thread" class="kr-comments lazy-load" data-path="/%E5%8E%8B%E5%88%B6%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/" data-full-path="http://fxxs.github.io/%E5%8E%8B%E5%88%B6%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/"></div>
        </div>
    
</article>

        

            </section>

            
                

<section id="kratos-widget-area" class="col-md-4 hidden-xs hidden-sm">
    <!-- 文章和页面根据splitter来分割，没有的话就从头开始设置为sticky -->
    
        <div class="sticky-area">
    
    
                    <aside id="krw-toc" class="widget widget-kratos-toc clearfix toc-div-class" >
    <div class="photo-background"></div>
    <h4 class="widget-title no-after">
        <i class="fa fa-compass"></i>
        文章目录
        <span class="toc-progress-bar" role="progressbar" aria-label="阅读进度："></span>
    </h4>
    <div class="textwidget">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%BA%90%E3%80%81%E7%BC%96%E7%A0%81%E3%80%81%E9%80%8F%E6%98%8E%E5%BA%A6%E5%AF%B9%E6%AF%94"><span class="toc-number">1.</span> <span class="toc-text">源、编码、透明度对比</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#x264-%E4%B8%8E-x265"><span class="toc-number">2.</span> <span class="toc-text">x264 与 x265</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8E%8B%E5%88%B6%E7%8E%AF%E5%A2%83%E6%9E%84%E5%BB%BA"><span class="toc-number">3.</span> <span class="toc-text">压制环境构建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E7%A0%81%E5%99%A8"><span class="toc-number">3.1.</span> <span class="toc-text">编码器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VapourSynth"><span class="toc-number">3.2.</span> <span class="toc-text">VapourSynth</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%85%B6%E4%BB%96%E8%BD%AF%E4%BB%B6"><span class="toc-number">3.3.</span> <span class="toc-text">常用其他软件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8E%8B%E5%88%B6%E6%AD%A5%E9%AA%A4"><span class="toc-number">4.</span> <span class="toc-text">压制步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%8B%E5%88%B6%E6%BA%90%E5%88%86%E6%9E%90"><span class="toc-number">4.1.</span> <span class="toc-text">压制源分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E7%A6%BB%E6%8F%90%E5%8F%96-Demux-%E4%B8%8E%E9%9F%B3%E9%A2%91%E8%BD%AC%E6%8D%A2"><span class="toc-number">4.2.</span> <span class="toc-text">分离提取(Demux)与音频转换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BE%93%E5%85%A5%E8%84%9A%E6%9C%AC%E7%BC%96%E5%86%99"><span class="toc-number">4.3.</span> <span class="toc-text">输入脚本编写</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%87%E6%BA%90%E8%BD%BD%E5%85%A5-Index-a-video"><span class="toc-number">4.3.0.1.</span> <span class="toc-text">片源载入(Index a video)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%87%E9%99%A4%E8%BE%B9%E7%BC%98"><span class="toc-number">4.3.0.2.</span> <span class="toc-text">切除边缘</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%98%E6%8D%A2%E5%A4%A7%E5%B0%8F"><span class="toc-number">4.3.0.3.</span> <span class="toc-text">变换大小</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%BD%E5%8F%96%E6%B5%8B%E8%AF%95"><span class="toc-number">4.3.0.4.</span> <span class="toc-text">抽取测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%8B%E5%88%B6%E6%B5%8B%E8%AF%95"><span class="toc-number">4.3.1.</span> <span class="toc-text">压制测试</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%8B%E5%88%B6%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE"><span class="toc-number">4.3.1.1.</span> <span class="toc-text">压制参数配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CRF%E6%B5%8B%E8%AF%95"><span class="toc-number">4.3.1.2.</span> <span class="toc-text">CRF测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%88%E7%90%86%E7%A0%81%E7%8E%87%E8%AF%84%E5%88%A4%E6%96%B9%E5%BC%8F"><span class="toc-number">4.3.1.2.1.</span> <span class="toc-text">合理码率评判方式</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%BD%E6%B1%82%E4%BD%93%E7%A7%AF"><span class="toc-number">4.3.1.2.1.1.</span> <span class="toc-text">追求体积</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BF%9D%E8%AF%81%E4%B8%8E%E5%8E%9F%E7%9B%98%E7%9B%B8%E4%BC%BC%E9%80%8F%E6%98%8E%E5%BA%A6"><span class="toc-number">4.3.1.2.1.2.</span> <span class="toc-text">保证与原盘相似透明度</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%8F%82%E6%95%B0"><span class="toc-number">4.3.1.3.</span> <span class="toc-text">其他参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%80%E7%BB%88CRF%E6%B5%8B%E8%AF%95"><span class="toc-number">4.3.1.4.</span> <span class="toc-text">最终CRF测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%8B%E5%88%B6%E5%AF%B9%E6%AF%94%E8%84%9A%E6%9C%AC%E7%BC%96%E5%86%99"><span class="toc-number">4.3.1.5.</span> <span class="toc-text">压制对比脚本编写</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A3%E5%BC%8F%E5%8E%8B%E5%88%B6"><span class="toc-number">4.3.2.</span> <span class="toc-text">正式压制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85"><span class="toc-number">4.3.3.</span> <span class="toc-text">封装</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#VapourSynth-%E8%84%9A%E6%9C%AC-vpy-Filtering-%E5%9F%BA%E7%A1%80%E6%BB%A4%E9%95%9C%E4%BB%A5%E5%8F%8A%E5%A4%84%E7%90%86"><span class="toc-number">5.</span> <span class="toc-text">VapourSynth 脚本(vpy) Filtering 基础滤镜以及处理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%A9%E6%94%BE-Resizing"><span class="toc-number">5.1.</span> <span class="toc-text">缩放(Resizing)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8D%E8%84%8F%E7%BA%BF-Dirty-Lines-%E5%8F%8A%E4%B8%8D%E5%90%88%E9%80%82%E7%9A%84%E8%BE%B9%E7%BC%98-Borders"><span class="toc-number">5.2.</span> <span class="toc-text">修复脏线(Dirty Lines)及不合适的边缘(Borders)</span></a></li></ol></li></ol>
    </div>
</aside>
                
                <aside id="krw-about" class="widget widget-kratos-about clearfix">
    <div class="photo-background"></div>
    <div class="photo-wrapper clearfix">
        <div class="photo-wrapper-tip text-center">
            <img class="about-photo" src="/img/avatar.png" alt="ted423" loading="lazy" decoding="auto" />
        </div>
    </div>
    <div class="textwidget">
        <p class="text-center"></p>
    </div>
    <div class="site-meta">
        <a class="meta-item" href="/archives/">
            <span class="title">
                文章
            </span>
            <span class="count">
                29
            </span>
        </a>
        <a class="meta-item" href="/categories/">
            <span class="title">
                分类
            </span>
            <span class="count">
                5
            </span>
        </a>
        <a class="meta-item" href="/tags/">
            <span class="title">
                标签
            </span>
            <span class="count">
                4
            </span>
        </a>
    </div>
</aside>
            
                
  <aside id="krw-categories" class="widget widget-kratos-categories clearfix">
    <h4 class="widget-title"><i class="fa fa-folder"></i>分类列表</h4>
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/1-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">1.基础知识</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/2-Tools/">2.Tools</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/3-Code/">3.Code</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/4-Audio-sub/">4.Audio&sub</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/6-etc/">6.etc</a><span class="category-list-count">6</span></li></ul>
  </aside>


            
                
  <aside id="krw-tags" class="widget widget-kratos-tags clearfix">
    <h4 class="widget-title"><i class="fa fa-tags"></i>标签聚合</h4>
      <div class="tag-clouds">
        <a href="/tags/Compare/" style="font-size: 0.6em;">Compare</a> <a href="/tags/Notes/" style="font-size: 0.6em;">Notes</a> <a href="/tags/Plugins-Scripts/" style="font-size: 0.7em;">Plugins&Scripts</a> <a href="/tags/%E5%BB%BA%E8%AE%BE%E4%B8%AD/" style="font-size: 0.8em;">建设中</a>
      </div>
  </aside>

            
    </div>
</section>
            

        

                </div>
    </div>
</div>

<footer>
    <div id="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-6 col-md-offset-3 footer-list text-center">
                    <ul class="kratos-social-icons">
                        
                    </ul>
                    <ul class="kratos-copyright">
                        <div>
                            <li>&copy; 2025 FXXS 版权所有.</li>
                            <li>本站已运行<span id="kr-since">Loading...</span></li>
                        </div>
                        <div>
                            <li>自豪地使用 <a href="https://github.com/Candinya/Kratos-Rebirth" target="_blank">Kratos:Rebirth</a> 主题</li>
                            <li>站点由 ted423 用 <i class="fa fa-heart" style="color:#d43f57"></i> 搭建</li>
                        </div>
                        <!-- 额外的追加注入项 -->
                        
                    </ul>
                </div>
            </div>
        </div>
        <div class="kr-tool text-center">
            <div class="tool">
                
                    <div class="box search-box">
                        <a href="/search">
                            <span class="fa fa-search"></span>
                        </a>
                    </div>
                
                <div class="box theme-box" id="theme-toggle">
                    <span class="fa fa-adjust"></span>
                </div>
            </div>
            <div id="gotop-box" class="box gotop-box">
                <span class="fa fa-chevron-up"></span>
            </div>
        </div>
    </div>
</footer>
</div>
</div>


    <div id="kr-donate-modal" class="kr-modal">
    <div class="kr-modal-bg" onclick="krCloseDonateModal()"></div>
    <div class="kr-modal-content">
        <div class="kr-modal-header">
            <div class="kr-modal-icon">
                <i class="fa fa-bitcoin"></i>
            </div>
            <div class="kr-modal-title">打赏</div>
            <button class="kr-modal-close" onclick="krCloseDonateModal()">
                <i class="fa fa-times-circle"></i>
            </button>
        </div>
        <div class="kr-modal-body">
            <div class="kr-donate-message">打赏提示信息</div>
            <div class="kr-donate-qr" id="kr-donate-qr">
                
            </div>
            <div class="kr-donate-platforms">
                
            </div>
        </div>
    </div>
</div>
<script defer src="/js/kr-modal/donate.min.js"></script>




    <div id="kr-share-modal" class="kr-modal">
    <div class="kr-modal-bg" onclick="krCloseShareModal()"></div>
    <div class="kr-modal-content">
        <div class="kr-modal-header">
            <div class="kr-modal-icon">
                <i class="fa fa-share-alt"></i>
            </div>
            <div class="kr-modal-title">分享</div>
            <button class="kr-modal-close" onclick="krCloseShareModal()">
                <i class="fa fa-times-circle"></i>
            </button>
        </div>
        <div class="kr-modal-body">
            <div class="kr-share-message">分享提示信息</div>
            <div class="kr-share-qr" id="kr-share-qr"></div>
            <div class="kr-share-platforms">
                
            </div>
        </div>
    </div>
</div>
<script defer src="/js/kr-modal/share.min.js"></script>



<!-- 额外的追加注入项 -->


        <script>
    if (!window.kr) {
        window.kr = {};
    }
    window.kr.notMobile = (!(navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)));
    window.kr.siteRoot = "/";
</script>


  <script defer src="/vendors/nprogress@0.2.0/nprogress.js"></script>



  <script defer src="/vendors/viewerjs@1.11.6/dist/viewer.min.js"></script>


<script defer src="/js/kr-core.min.js"></script>


  <script defer src="/js/kr-pjax.min.js"></script>


<!-- 额外的追加注入项 -->

  <script src="https://https-ted423-github-io.disqus.com/embed.js"></script>
<script async id="dsq-count-scr" src="https://https-ted423-github-io.disqus.com/count.js"></script>
<script src="/comments/disqus.js"></script>



    </body>
</html>